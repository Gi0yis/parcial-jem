<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Examen</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="formulario">
        <h2>Ingrese sus datos</h2>
        <p><strong>Instrucciones:</strong> Complete los campos con su información y presione "Comenzar" para iniciar el examen. Una vez iniciado, tendrá 15 minutos para completarlo. Al finalizar el tiempo, el examen se enviará automáticamente.</p>
        <input type="text" id="nombre" placeholder="Nombre" required>
        <input type="text" id="grado" placeholder="Grado" required>
        <input type="text" id="curso" placeholder="Curso" required>
        <button onclick="iniciarExamen()">Comenzar</button>
    </div>

    <div id="examen" style="display: none;">
        <h2>Examen de Conocimientos</h2>
        <p><strong>Tiempo restante: <span id="cronometro">15:00</span></strong></p>
        <p><strong>Instrucciones:</strong> Responda todas las preguntas seleccionando la opción correcta. Si el tiempo se acaba, el examen se enviará automáticamente.</p>
        <form id="quizForm">
            <div id="preguntas"></div>
            <button type="submit">Enviar respuestas</button>
        </form>
    </div>

    <footer>
        <p>Desarrollado por Giovanni López</p>
    </footer>

    <script>
        let tiempoRestante = 15 * 60; 
        let temporizador;

        const preguntas = [
            "Las tablas no admiten filas por debajo de la fila de totales",
            "Mediante una segmentación de datos, podemos filtrar tanto en rangos como en tablas",
            "Podemos ordenar los datos de una tabla por más de una columna",
            "La referencia que hacemos de la siguiente forma a la celda B1: $B$1, es una referencia relativa",
            "Convertir una tabla en un rango mantiene el formato de la tabla, pero elimina su funcionalidad",
            "Es posible cambiar el tamaño de una tabla agregando o eliminando filas y columnas",
            "Una tabla en Excel puede tener un nombre definido que facilita su referencia en fórmulas",
            "Las referencias relativas cambian cuando se copian a otra celda, mientras que las absolutas permanecen fijas",
            "La fila de totales en una tabla se actualiza automáticamente al modificar los datos",
            "Al convertir una tabla en un rango, las fórmulas utilizadas dentro de ella siguen funcionando",
            "Se pueden aplicar formatos condicionales a una tabla sin afectar el resto de la hoja de cálculo",
            "Una segmentación de datos permite seleccionar múltiples valores a la vez en un filtro",
            "Las referencias mixtas combinan características de referencias absolutas y relativas",
            "Se pueden usar referencias absolutas dentro de una tabla para asegurar que los cálculos no cambien al copiar fórmulas",
            "Es posible aplicar filtros avanzados en una tabla utilizando criterios personalizados"
        ];

        function actualizarCronometro() {
            const minutos = Math.floor(tiempoRestante / 60);
            const segundos = tiempoRestante % 60;
            document.getElementById("cronometro").textContent = `${minutos}:${segundos < 10 ? '0' : ''}${segundos}`;
            
            if (tiempoRestante <= 0) {
                clearInterval(temporizador);
                document.getElementById('quizForm').submit();
            } else {
                tiempoRestante--;
            }
        }

        function iniciarExamen() {
            const nombre = document.getElementById('nombre').value.trim();
            const grado = document.getElementById('grado').value.trim();
            const curso = document.getElementById('curso').value.trim();

            if (!nombre || !grado || !curso) {
                alert("Por favor, complete todos los campos antes de comenzar.");
                return;
            }

            document.getElementById('formulario').style.display = 'none';
            document.getElementById('examen').style.display = 'block';
            
            temporizador = setInterval(actualizarCronometro, 1000);

            const contenedorPreguntas = document.getElementById('preguntas');
            preguntas.forEach((pregunta, index) => {
                const div = document.createElement('div');
                div.innerHTML = `
                    <p>${pregunta}</p>
                    <label><input type="radio" name="pregunta${index}" value="Verdadero"> Verdadero</label>
                    <label><input type="radio" name="pregunta${index}" value="Falso"> Falso</label>
                    <label><input type="radio" name="pregunta${index}" value="No sé"> No sé</label>
                `;
                contenedorPreguntas.appendChild(div);
            });
        }

        document.getElementById('quizForm').addEventListener('submit', function(event) {
            event.preventDefault();
            clearInterval(temporizador);

            const nombre = document.getElementById('nombre').value;
            const grado = document.getElementById('grado').value;
            const curso = document.getElementById('curso').value;
            const respuestas = [];

            let todasRespondidas = true;
            preguntas.forEach((_, index) => {
                const seleccionada = document.querySelector(`input[name='pregunta${index}']:checked`);
                if (seleccionada) {
                    respuestas.push(seleccionada.value);
                } else {
                    todasRespondidas = false;
                }
            });

            if (!todasRespondidas) {
                alert("Debe responder todas las preguntas antes de enviar.");
                return;
            }

            fetch('https://cace-2800-98-1118-6f7-110a-e7ef-f25d-eebd.ngrok-free.app/enviar_respuestas', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ nombre, grado, curso, respuestas })
            })
            .then(response => response.json())
            .then(data => {
                alert(`Respuestas enviadas. Puntaje: ${data.puntaje}`);
                location.reload();
            })
            .catch(error => console.error('Error:', error));
        });
    </script>
</body>
</html>
